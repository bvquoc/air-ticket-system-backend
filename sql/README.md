# Flight Booking System Database Schema Documentation

This document describes the database schema for the Flight Booking System, which includes tables for users, bookings, payments, directions, passengers, aircrafts, flights, seats, and tickets.

## Tables

### Users Table
The `users` table stores information about users in the system, including their authentication details and roles.

```sql
create table if not exists users
(
    id        bigint generated by default as identity primary key,
    email     varchar(255),
    name      varchar(255),
    password  varchar(255),
    user_role varchar(255)
        constraint users_user_role_check check ((user_role)::text = ANY (ARRAY [('USER'::character varying)::text, ('ADMIN'::character varying)::text])),
    username  varchar(255) unique
);
```

- `id`: Primary key, unique identifier for the user.
- `email`: Email address of the user.
- `name`: Full name of the user.
- `password`: User's password.
- `user_role`: Role of the user, either 'USER' or 'ADMIN'.
- `username`: Unique username for login.

#### Indexes:
```sql
create index if not exists idx_users_email on users (email);
create index if not exists idx_users_username on users (username);
```

### Bookings Table
The `bookings` table stores booking information, including the user who made the booking, the date, and the status of the booking.

```sql
create table if not exists bookings
(
    booking_id   serial primary key,
    user_id      bigint references users on delete cascade,
    booking_date timestamp default CURRENT_TIMESTAMP,
    total_amount numeric(10, 2),
    status       varchar(50)
);
```

- `booking_id`: Primary key, unique identifier for the booking.
- `user_id`: Foreign key referencing `users.id`, the user who made the booking.
- `booking_date`: Date and time when the booking was created.
- `total_amount`: Total amount for the booking.
- `status`: Status of the booking (e.g., 'confirmed', 'canceled').

### Payments Table
The `payments` table stores payment details related to bookings.

```sql
create table if not exists payments
(
    payment_id     serial primary key,
    booking_id     integer references bookings on delete cascade,
    payment_date   timestamp default CURRENT_TIMESTAMP,
    amount         numeric(10, 2),
    payment_method varchar(50),
    status         varchar(50)
);
```

- `payment_id`: Primary key, unique identifier for the payment.
- `booking_id`: Foreign key referencing `bookings.booking_id`.
- `payment_date`: Date and time when the payment was made.
- `amount`: Payment amount.
- `payment_method`: Method of payment (e.g., 'credit card', 'paypal').
- `status`: Payment status (e.g., 'completed', 'pending').

#### Indexes:
```sql
create index if not exists idx_booking_id on payments (booking_id);
```

### Direction Bookings Table
The `direction_bookings` table stores the details of each direction within a booking (origin, destination, and dates).

```sql
create table if not exists direction_bookings
(
    direction_booking_id serial primary key,
    booking_id           integer references bookings on delete cascade,
    origin               varchar(100),
    destination          varchar(100),
    departure_date       timestamp,
    arrival_date         timestamp
);
```

- `direction_booking_id`: Primary key, unique identifier for the direction booking.
- `booking_id`: Foreign key referencing `bookings.booking_id`.
- `origin`: Origin location of the flight.
- `destination`: Destination location of the flight.
- `departure_date`: Departure date and time.
- `arrival_date`: Arrival date and time.

### Passengers Table
The `passengers` table stores personal information of passengers.

```sql
create table if not exists passengers
(
    passenger_id    serial primary key,
    first_name      varchar(100),
    last_name       varchar(100),
    date_of_birth   date,
    passport_number varchar(50),
    nationality     varchar(50)
);
```

- `passenger_id`: Primary key, unique identifier for the passenger.
- `first_name`: Passenger's first name.
- `last_name`: Passenger's last name.
- `date_of_birth`: Passenger's date of birth.
- `passport_number`: Passport number of the passenger.
- `nationality`: Passenger's nationality.

### Aircrafts Table
The `aircrafts` table stores information about the aircrafts available for flights.

```sql
create table if not exists aircrafts
(
    aircraft_id      serial primary key,
    aircraft_model   varchar(100),
    manufacturer     varchar(100),
    seating_capacity integer
);
```

- `aircraft_id`: Primary key, unique identifier for the aircraft.
- `aircraft_model`: Model name of the aircraft.
- `manufacturer`: Manufacturer of the aircraft.
- `seating_capacity`: Total seating capacity of the aircraft.

### Flights Table
The `flights` table stores information about individual flights, including flight number, times, and the aircraft assigned.

```sql
create table if not exists flights
(
    flight_id      serial primary key,
    flight_number  varchar(50) unique,
    departure_time timestamp,
    arrival_time   timestamp,
    origin         varchar(100),
    destination    varchar(100),
    aircraft_id    integer references aircrafts on delete cascade
);
```

- `flight_id`: Primary key, unique identifier for the flight.
- `flight_number`: Unique flight number.
- `departure_time`: Date and time of flight departure.
- `arrival_time`: Date and time of flight arrival.
- `origin`: Origin location of the flight.
- `destination`: Destination location of the flight.
- `aircraft_id`: Foreign key referencing `aircrafts.aircraft_id`.

### Seats Table
The `seats` table stores information about the seats available on each aircraft.

```sql
create table if not exists seats
(
    seat_id      serial primary key,
    aircraft_id  integer references aircrafts on delete cascade,
    seat_number  varchar(10),
    seat_type    varchar(50),
    is_available boolean default true
);
```

- `seat_id`: Primary key, unique identifier for the seat.
- `aircraft_id`: Foreign key referencing `aircrafts.aircraft_id`.
- `seat_number`: Seat number.
- `seat_type`: Type of the seat (e.g., 'economy', 'business').
- `is_available`: Whether the seat is available for booking.

### Tickets Table
The `tickets` table stores ticket details for passengers, including associated bookings, flights, seats, and passengers.

```sql
create table if not exists tickets
(
    ticket_id            serial primary key,
    direction_booking_id integer references direction_bookings on delete cascade,
    flight_id            integer references flights on delete cascade,
    seat_id              integer references seats on delete cascade,
    passenger_id         integer references passengers on delete cascade,
    ticket_status        varchar(50)
);
```

- `ticket_id`: Primary key, unique identifier for the ticket.
- `direction_booking_id`: Foreign key referencing `direction_bookings.direction_booking_id`.
- `flight_id`: Foreign key referencing `flights.flight_id`.
- `seat_id`: Foreign key referencing `seats.seat_id`.
- `passenger_id`: Foreign key referencing `passengers.passenger_id`.
- `ticket_status`: Status of the ticket (e.g., 'booked', 'canceled').

#### Indexes:
```sql
create index if not exists idx_flight_id on tickets (flight_id);
create index if not exists idx_seat_id on tickets (seat_id);
create index if not exists idx_passenger_id on tickets (passenger_id);
```

## Ownership
Each table is owned by the `postgres` role.

```sql
alter table <table_name> owner to postgres;
```

---

This schema provides a comprehensive structure for a flight booking system, supporting functionalities like user management, booking creation, payment processing, and flight details management.
